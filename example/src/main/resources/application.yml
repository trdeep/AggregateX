spring:
  application:
    name: AggregateX

  datasource:
    driver-class-name: org.postgresql.Driver
    url: jdbc:postgresql://localhost:5432/ddd
    username: root
    password: 123456
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      minimum-idle: 5
      maximum-pool-size: 20
      auto-commit: true
      idle-timeout: 3000
      pool-name: DatebookHikariCP
      max-lifetime: 1800000
      connection-timeout: 30000
      connection-test-query: SELECT 1
      validation-timeout: 3000
      login-timeout: 5
      read-only: false

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    open-in-view: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect

  data:
    redis:
      host: localhost
      port: 6379
      password: 123456
      timeout: 60000
      database: 0
      lettuce:
        pool:
          max-active: 8
          max-wait: -1ms
          max-idle: 8
          min-idle: 0

  cache:
    type: caffeine
    cache-names:
      - events
      - snapshots
      - archives
      - aggregates
    caffeine:
      spec: maximumSize=10000,expireAfterWrite=3600s

app:
  event-store:
    type: jpa             # \u4E8B\u4EF6\u5B58\u50A8\u7C7B\u578B\uFF1Amemory/jpa
    table-name: events    # \u4E8B\u4EF6\u8868\u540D\u79F0\uFF08JPA\u6A21\u5F0F\uFF09
    batch-size: 1000      # \u6279\u91CF\u64CD\u4F5C\u5927\u5C0F
    snapshot:
      enabled: true       # \u662F\u5426\u542F\u7528\u5FEB\u7167
      frequency: 100      # \u5FEB\u7167\u9891\u7387\uFF08\u4E8B\u4EF6\u6570\uFF09

  event-bus:
    type: simple          # \u4E8B\u4EF6\u603B\u7EBF\u7C7B\u578B\uFF1Asimple/rabbitmq
    async: true           # \u662F\u5426\u542F\u7528\u5F02\u6B65\u5904\u7406
    pool-size: 5          # \u5F02\u6B65\u5904\u7406\u7EBF\u7A0B\u6C60\u5927\u5C0F
    retry:
      max-attempts: 3     # \u6700\u5927\u91CD\u8BD5\u6B21\u6570
      initial-delay: 1000 # \u521D\u59CB\u91CD\u8BD5\u5EF6\u8FDF\uFF08\u6BEB\u79D2\uFF09

  event-archive:
    enabled: true

  audit:
    enabled: true

  cqrs:
    async:
      core-pool-size: 5
      max-pool-size: 10
      queue-capacity: 25
      thread-name-prefix: async-command-
    retry:
      max-attempts: 3
      initial-delay: 1000
      multiplier: 2.0
      max-delay: 10000
    validation:
      fail-fast: true
      validation-enabled: true

  architecture:
    validation:
      enabled: true

# \u65E5\u5FD7\u914D\u7F6E
logging:
  config: classpath:logback-spring.xml
  level:
    cn.treedeep.king: debug
    org.hibernate.orm.connections.pooling: warn
    org.springframework: warn

# \u76D1\u63A7\u914D\u7F6E
management:
  endpoints:
    web:
      exposure:
        include: health,metrics,prometheus
  endpoint:
    health:
      show-details: always
    metrics:
      access: read_only
    prometheus:
      access: read_only
  metrics:
    tags:
      application: ${spring.application.name}
      env: ${spring.profiles.active}


knife4j:
  enable: true
  setting:
    enable-footer-custom: true
    footer-custom-content: KingAdmin API Documentation | Copyright \u00A9\uFE0F 2025 Rubin

springdoc:
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: alpha

  api-docs:
    path: /v3/api-docs
  group-configs:
    - group: king-rest
      paths-to-match:
        - /api/users/**
      packages-to-scan:
        - cn.treedeep.king.user.presentation
    - group: king-example
      paths-to-match:
        - /api/example/users/**
      packages-to-scan:
        - cn.treedeep.king.user.presentation
